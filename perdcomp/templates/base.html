<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Sistema PERDCOMP{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap 5 CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons (opcional) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <!-- CSS personalizado para logomarcas -->
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    {% load static %}
    <link href="{% static 'css/logomarcas.css' %}" rel="stylesheet">
    <style>
        body {
            background: #fff;
            color: #111;
            font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
        }
        .navbar-brand {
            font-weight: bold;
            letter-spacing: 1px;
        }
        .nav-link:focus {
            outline: 2px solid #0d6efd;
            outline-offset: 2px;
        }
        .user-avatar {
            object-fit: contain;
            border-radius: 4px;
            background-color: white;
            border: 1px solid rgba(0,0,0,0.1);
            padding: 1px;
        }
    </style>
    {% block extra_head %}{% endblock %}
</head>
<body>
    <!-- Top Bar Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom shadow-sm" role="navigation" aria-label="Menu principal">
        <div class="container">PerdComp</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Alternar navegação">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                  {% if user.is_authenticated %}
                    
                   
                        {% if user.is_superuser or user.is_staff %}
                        <li class="nav-item dropdown">
                          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-people me-1"></i>Vinculos
                          </a>
                          <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{% url 'novo_cliente' %}"><i class="bi bi-person-plus me-1"></i>Cliente</a></li>
                            <li><a class="dropdown-item" href="{% url 'novo_parceiro' %}"><i class="bi bi-person-plus me-1"></i>Parceiro </a></li>
                            <li><a class="dropdown-item" href="{% url 'lista_clientes' %}"><i class="bi bi-list me-1"></i>Listar Clientes</a></li>
                            <li><a class="dropdown-item" href="{% url 'lista_parceiros' %}"><i class="bi bi-list me-1"></i>Listar Parceiros</a></li>
                          </ul>
                        </li>
                        {% endif %}
                      
                      
                      <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                          <i class="bi bi-journal-text me-1"></i>Teses de Crédito</a>
                        <ul class="dropdown-menu">
                          <li><a class="dropdown-item" href="{% url 'correcao:tese_credito_list' %}"><i class="bi bi-list me-1"></i>Listar Teses</a></li>
                          {% if user.is_superuser or user.is_staff %}
                          <li><a class="dropdown-item" href="{% url 'correcao:tese_credito_create' %}"><i class="bi bi-plus me-1"></i>Nova Tese</a></li>
                          {% endif %}
                          <li><hr class="dropdown-divider"></li>
                          <li><a class="dropdown-item" href="{% url 'correcao:tipo_tese_list' %}"><i class="bi bi-tags me-1"></i>Tipos de Tese</a></li>
                        </ul>
                      </li>
                      
                      <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                          <i class="bi bi-pencil-square me-1"></i>Correções</a>
                        <ul class="dropdown-menu">
                          <li><a class="dropdown-item" href="{% url 'correcao:list' %}"><i class="bi bi-list me-1"></i>Listar Correções</a></li>
                          {% if user.is_superuser or user.is_staff %}
                          <li><a class="dropdown-item" href="{% url 'correcao:create' %}"><i class="bi bi-plus me-1"></i>Nova Correção</a></li>
                          {% endif %}
                        </ul>
                      </li>
                      
                      <!-- Dashboard -->
                      <li class="nav-item">
                        <a class="nav-link" href="{% url 'dashboard:dashboard' %}">
                          <i class="bi bi-speedometer2 me-1"></i>Dashboard
                        </a>
                      </li>
                    {% endif %}
                    
                    
                      {# Menu Parceiro removido para clientes comuns, só aparece para admin/staff no bloco acima #}
                      
                      {% if not user.profile.eh_cliente %}
                      <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                          <i class="bi bi-file-earmark-plus me-1"></i>Adesões</a>
                        <ul class="dropdown-menu">
                          <li><a class="dropdown-item" href="{% url 'adesao:list' %}"><i class="bi bi-list me-1"></i>Listar Adesões</a></li>
                          {% if user.is_superuser or user.is_staff %}
                          <li><a class="dropdown-item" href="{% url 'adesao:create' %}"><i class="bi bi-plus me-1"></i>Nova Adesão</a></li>
                          {% endif %}
                        </ul>
                      </li>
                      {% endif %}
                      
                      <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                          <i class="bi bi-cash-stack me-1"></i>Compensações</a>
                        <ul class="dropdown-menu">
                          <li><a class="dropdown-item" href="{% url 'lancamentos:list' %}"><i class="bi bi-list me-1"></i>Listar Declarações</a></li>
                          {% if user.is_superuser or user.is_staff %}
                          <li><a class="dropdown-item" href="{% url 'lancamentos:create' %}"><i class="bi bi-plus me-1"></i>Nova Declaração</a></li>
                          {% endif %}
                        </ul>
                      </li>
                    
                    
                    {% if user.profile.eh_cliente %}
                      <!-- Menu Cliente: Acesso Limitado (Apenas Visualização) -->
                      <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                          <i class="bi bi-file-earmark-plus me-1"></i>Adesões</a>
                        <ul class="dropdown-menu">
                          <li><a class="dropdown-item" href="{% url 'adesao:list' %}"><i class="bi bi-list me-1"></i>Listar Adesões</a></li>
                        </ul>
                      </li>
                      
                      <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                          <i class="bi bi-cash-stack me-1"></i>Declaração de compensação</a>
                        <ul class="dropdown-menu">
                          <li><a class="dropdown-item" href="{% url 'lancamentos:list' %}"><i class="bi bi-list me-1"></i>Listar Declarações</a></li>
                        </ul>
                      </li>
                    {% endif %}

                    {% if user.is_authenticated and user.profile.eh_cliente %}
                      <!-- dashboard -->
                      <li class="nav-item">
                        <a class="nav-link" href="{% url 'accounts:cliente_dashboard' %}">
                          <i class="bi bi-speedometer2 me-1"></i>Dashboard
                        </a>
                      </li>
                    {% endif %}
                    {% if user.is_authenticated and user.profile.eh_parceiro %}
                      <!-- dashboard -->
                      <li class="nav-item">
                        <a class="nav-link" href="{% url 'accounts:parceiro_dashboard' %}">
                          <i class="bi bi-speedometer2 me-1"></i>Dashboard
                        </a>
                      </li>
                    {% endif %}

                    {% if user.is_authenticated %}
                    
                      <!-- Menu de Perfil -->
                      <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            {% if user.profile.empresa_vinculada and user.profile.empresa_vinculada.logomarca %}
                            <img src="{{ user.profile.empresa_vinculada.logomarca.url }}" alt="{{ user.profile.empresa_vinculada.nome_fantasia|default:user.profile.empresa_vinculada.razao_social }}" class="user-avatar me-1" width="24" height="24">
                            {% elif user.profile.empresa_base and user.profile.empresa_base.logomarca %}
                            <img src="{{ user.profile.empresa_base.logomarca.url }}" alt="{{ user.profile.empresa_base.nome_fantasia|default:user.profile.empresa_base.razao_social }}" class="user-avatar me-1" width="24" height="24">
                            {% else %}
                            <i class="bi bi-person-circle me-1"></i>
                            {% endif %}
                            {{ user.username }}
                        </a>
                        <ul class="dropdown-menu">
                          <li><a class="dropdown-item" href="{% url 'accounts:profile' %}"><i class="bi bi-person me-1"></i>Meu Perfil</a></li>
                          <li><hr class="dropdown-divider"></li>
                          <li><a class="dropdown-item" href="{% url 'accounts:logout' %}"><i class="bi bi-box-arrow-right me-1"></i>Sair</a></li>
                        </ul>
                      </li>
                    {% endif %}
                 
                </ul>
            </div>
        </div>
    </nav>


    <main class="container py-4" tabindex="-1">
        <!-- Mensagens do sistema -->
        {% if messages %}
            <div class="messages-container mb-4">
                {% for message in messages %}
                <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags|default:'info' }}{% endif %} alert-dismissible fade show" role="alert">
                    {% if message.tags == 'success' %}<i class="bi bi-check-circle-fill me-2"></i>{% endif %}
                    {% if message.tags == 'warning' %}<i class="bi bi-exclamation-triangle-fill me-2"></i>{% endif %}
                    {% if message.tags == 'error' %}<i class="bi bi-x-circle-fill me-2"></i>{% endif %}
                    {% if message.tags == 'info' %}<i class="bi bi-info-circle-fill me-2"></i>{% endif %}
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
                </div>
                {% endfor %}
            </div>
        {% endif %}
        
        {% block content %}{% endblock %}
    </main>

    <footer class="footer mt-auto py-3 border-top bg-light text-center text-muted">
        <div class="container">
            © 2025 PERDCOMP. Todos os direitos reservados.
            <span class="mx-2">|</span>
            <a href="#" class="text-decoration-none">Política de Privacidade</a>
            <span class="mx-2">|</span>
            <a href="#" class="text-decoration-none">Termos de Uso</a>
            <span class="mx-2">|</span>
            <a href="#" class="text-decoration-none">Contato</a>
        </div>
    </footer>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Scripts personalizados -->
    {% load static %}
    <script src="{% static 'js/logout-confirm.js' %}"></script>
    
    {% block extra_js %}{% endblock %}
    
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Modal de sucesso
        var hasSuccess = document.querySelector('#successModal .alert-success');
        if (hasSuccess) {
          var modal = new bootstrap.Modal(document.getElementById('successModal'));
          modal.show();
        }
        
        // Auto-dismiss para alerts
        const alerts = document.querySelectorAll('.alert-dismissible');
        alerts.forEach(function(alert) {
          setTimeout(function() {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
          }, 5000); // Fecha após 5 segundos
        });
      });
    </script>
</body>
</html>
