{% load static %}
<!DOCTYPE html>
<html lang="pt-BR" class="h-full">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Sistema PERDCOMP{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="{% static 'css/app.css' %}">
    <link href="{% static 'css/logomarcas.css' %}" rel="stylesheet">
    
    <!-- Dark mode initialization -->
    <script>
        const root = document.documentElement;
        const stored = localStorage.getItem('theme');
        if(stored === 'dark' || (!stored && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            root.classList.add('dark');
        }
    </script>
    
    {% block extra_head %}{% endblock %}
</head>
<body class="min-h-full bg-background text-foreground flex flex-col">
    <!-- Navigation Header -->
    <nav class="border-b bg-white/80 dark:bg-slate-950/80 backdrop-blur supports-[backdrop-filter]:bg-white/70 dark:supports-[backdrop-filter]:bg-slate-950/60 sticky top-0 z-50" role="navigation" aria-label="Menu principal">
        <div class="container mx-auto px-4">
            <div class="flex h-16 items-center justify-between">
                <!-- Brand -->
                <div class="flex items-center">
                    <a href="{% url 'root' %}" class="text-xl font-bold tracking-wider text-primary hover:text-primary/80 transition-colors">PerdComp</a>
                </div>

                <!-- Mobile menu button -->
                <div class="md:hidden">
                    <button type="button" id="mobile-menu-button" class="inline-flex items-center justify-center rounded-md p-2 text-slate-600 hover:bg-slate-100 hover:text-slate-900 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:text-slate-300 dark:hover:bg-slate-800 dark:hover:text-slate-100" aria-controls="mobile-menu" aria-expanded="false">
                        <span class="sr-only">Abrir menu principal</span>
                        <svg class="block h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                        </svg>
                    </button>
                </div>

                <!-- Desktop menu -->
                <div class="hidden md:block">
                    <div class="ml-10 flex items-center space-x-1">
                        {% if user.is_authenticated %}

                        {# Vínculos: somente se staff/superuser ou tiver permissões do app clientes_parceiros (ajuste o codename conforme modelos) #}
                        {% if user.is_superuser or user.is_staff and perms.clientes_parceiros.view_clientesparceiros %}
                        <!-- Vínculos Dropdown -->
                        <div class="relative group">
                            <button type="button" class="inline-flex items-center rounded-md px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100 hover:text-slate-900 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:text-slate-300 dark:hover:bg-slate-800 dark:hover:text-slate-100 group-hover:bg-slate-100 dark:group-hover:bg-slate-800 transition-colors" aria-expanded="false">
                                <i class="bi bi-people mr-2"></i>
                                Vínculos
                                <svg class="ml-1 h-4 w-4 transition-transform group-hover:rotate-180" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                                </svg>
                            </button>
                            <div class="absolute left-0 mt-2 w-48 origin-top-left rounded-md border bg-white shadow-lg ring-1 ring-black ring-opacity-5 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 dark:bg-slate-900 dark:border-slate-700 z-10">
                                <div class="py-1">
                                    {% if perms.clientes_parceiros.add_clientesparceiros %}
                                    <a href="{% url 'novo_cliente' %}" class="flex items-center px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800 transition-colors"><i class="bi bi-person-plus mr-2"></i>Novo Cliente</a>
                                    <a href="{% url 'novo_parceiro' %}" class="flex items-center px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800 transition-colors"><i class="bi bi-person-plus mr-2"></i>Novo Parceiro</a>
                                    {% endif %}
                                    {% if perms.clientes_parceiros.view_clientesparceiros %}
                                    <a href="{% url 'lista_clientes' %}" class="flex items-center px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800 transition-colors"><i class="bi bi-list mr-2"></i>Listar Clientes</a>
                                    <a href="{% url 'lista_parceiros' %}" class="flex items-center px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800 transition-colors"><i class="bi bi-list mr-2"></i>Listar Parceiros</a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        

                        <!-- Dashboard Unificado -->
                        {% if user.is_authenticated %}
                        <a href="{% url 'accounts:dashboard' %}" class="inline-flex items-center rounded-md px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100 hover:text-slate-900 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:text-slate-300 dark:hover:bg-slate-800 dark:hover:text-slate-100 transition-colors"><i class="bi bi-speedometer2 mr-2"></i>Dashboard</a>
                        {% endif %}

                        {% if user.is_authenticated %}
                        <!-- Adesões Dropdown (liberado para qualquer autenticado; criação só para staff/superuser) -->
                        <div class="relative group">
                            <button type="button" class="inline-flex items-center rounded-md px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100 hover:text-slate-900 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:text-slate-300 dark:hover:bg-slate-800 dark:hover:text-slate-100 group-hover:bg-slate-100 dark:group-hover:bg-slate-800 transition-colors">
                                <i class="bi bi-file-earmark-plus mr-2"></i>
                                Adesões
                                <svg class="ml-1 h-4 w-4 transition-transform group-hover:rotate-180" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                                </svg>
                            </button>
                            <div class="absolute left-0 mt-2 w-48 origin-top-left rounded-md border bg-white shadow-lg ring-1 ring-black ring-opacity-5 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 dark:bg-slate-900 dark:border-slate-700 z-10">
                                <div class="py-1">
                                    <a href="{% url 'adesao:list' %}" class="flex items-center px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800 transition-colors"><i class="bi bi-list mr-2"></i>Listar Adesões</a>
                                    {% if user.is_superuser or user.is_staff or perms.adesao.add_adesao %}
                                    <a href="{% url 'adesao:create' %}" class="flex items-center px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800 transition-colors"><i class="bi bi-plus mr-2"></i>Nova Adesão</a>
                                    <a href="{% url 'adesao:importar_lote_page' %}" class="flex items-center px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800 transition-colors"><i class="bi bi-files mr-2"></i>Importação de PDFs</a>
                                    <a href="{% url 'adesao:importacao_logs_page' %}" class="flex items-center px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800 transition-colors"><i class="bi bi-clipboard-data mr-2"></i>Logs de importação</a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        {% if user.is_authenticated %}
                        <!-- Compensações Dropdown (liberado para qualquer autenticado; criação restrita) -->
                        <div class="relative group">
                            <button type="button" class="inline-flex items-center rounded-md px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100 hover:text-slate-900 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:text-slate-300 dark:hover:bg-slate-800 dark:hover:text-slate-100 group-hover:bg-slate-100 dark:group-hover:bg-slate-800 transition-colors">
                                <i class="bi bi-arrow-left-right mr-2"></i>
                                Compensações
                                <svg class="ml-1 h-4 w-4 transition-transform group-hover:rotate-180" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                                </svg>
                            </button>
                            <div class="absolute left-0 mt-2 w-48 origin-top-left rounded-md border bg-white shadow-lg ring-1 ring-black ring-opacity-5 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 dark:bg-slate-900 dark:border-slate-700 z-10">
                                <div class="py-1">
                                    <a href="{% url 'lancamentos:list' %}" class="flex items-center px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800 transition-colors"><i class="bi bi-list mr-2"></i>Listar Declarações</a>
                                    {% if user.is_superuser or user.is_staff or perms.lancamentos.add_lancamentos %}
                                    <a href="{% url 'lancamentos:create' %}" class="flex items-center px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800 transition-colors"><i class="bi bi-plus mr-2"></i>Nova Declaração</a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        
                        {# Bloco específico de cliente removido porque agora menu Adesões é universal #}


                        
                        <!-- Menu de Perfil do Usuário -->
                        {% if user.is_authenticated %}
                        <div class="relative group flex items-center">
                            <button type="button" class="inline-flex items-center rounded-md px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100 hover:text-slate-900 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:text-slate-300 dark:hover:bg-slate-800 dark:hover:text-slate-100 group-hover:bg-slate-100 dark:group-hover:bg-slate-800 transition-colors">
                                {% if user.is_authenticated and user.profile and user.profile.foto_perfil %}
                                <img src="{{ user.profile.foto_perfil.url }}" alt="{{ user.get_full_name|default:user.username }}" class="w-6 h-6 rounded-full object-cover border border-slate-200 dark:border-slate-700 mr-2 bg-white" />
                                {% elif user.is_authenticated and user.profile and user.profile.empresa_vinculada and user.profile.empresa_vinculada.logomarca %}
                                <img src="{{ user.profile.empresa_vinculada.logomarca.url }}" alt="{{ user.profile.empresa_vinculada.nome_fantasia|default:user.profile.empresa_vinculada.razao_social }}" class="w-6 h-6 object-contain rounded border border-slate-200 dark:border-slate-700 mr-2 bg-white" />
                                {% else %}
                                <i class="bi bi-person-circle mr-2"></i>
                                {% endif %}
                                {{ user.username }}
                                <svg class="ml-1 h-4 w-4 transition-transform group-hover:rotate-180" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                                </svg>
                            </button>
                            <div class="absolute right-0 mt-2 w-48 origin-top-right rounded-md border bg-white shadow-lg ring-1 ring-black ring-opacity-5 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 dark:bg-slate-900 dark:border-slate-700 z-10" style="top: 100%;">
                                <div class="py-1">
                                    {% if not user.is_superuser and not user.is_staff %}
                                    <a href="{% url 'accounts:profile' %}" class="flex items-center px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800 transition-colors">
                                        <i class="bi bi-person mr-2"></i>Meu Perfil
                                    </a>
                                    <div class="border-t border-slate-200 dark:border-slate-700 my-1"></div>
                                    {% else %}
                                    <a href="{% url 'admin:index' %}" class="flex items-center px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800 transition-colors"><i class="bi bi-shield-lock mr-2"></i>Painel Admin</a>
                                    <div class="border-t border-slate-200 dark:border-slate-700 my-1"></div>
                                    {% endif %}
                                    <a href="{% url 'accounts:logout' %}" class="flex items-center px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800 transition-colors">
                                        <i class="bi bi-box-arrow-right mr-2"></i>Sair
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Theme Toggle -->
                        <button type="button" id="theme-toggle" class="ml-2 rounded-md p-2 text-slate-600 hover:bg-slate-100 hover:text-slate-900 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:text-slate-300 dark:hover:bg-slate-800 dark:hover:text-slate-100 transition-colors">
                            <span class="sr-only">Alternar tema</span>
                            <svg class="h-5 w-5 block dark:hidden" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
                            </svg>
                            <svg class="h-5 w-5 hidden dark:block" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M6.75 12H4.5m.386-6.364l1.591 1.591" />
                            </svg>
                        </button>
                        {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile menu -->
        <div class="md:hidden hidden" id="mobile-menu">
            <div class="border-t border-slate-200 dark:border-slate-700 px-2 pt-3 pb-4 space-y-2 text-sm" aria-label="Menu mobile">
                {% if user.is_authenticated %}
                <!-- Dashboard (varia por tipo) -->
                {% if user.is_authenticated %}
                <a href="{% url 'accounts:dashboard' %}" class="flex items-center gap-2 px-3 py-2 rounded-md font-medium text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800"><i class="bi bi-speedometer2"></i> Dashboard</a>
                {% endif %}

                <!-- Grupo reutilizável macro-like (manual) -->
                {% if user.is_superuser or user.is_staff or perms.clientes_parceiros.view_clientesparceiros %}
                <div class="border border-slate-200 dark:border-slate-700 rounded-md" x-data>
                    <button type="button" class="w-full flex items-center justify-between px-3 py-2 rounded-md font-medium text-left text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800" data-mobile-toggle="vinculos" aria-expanded="false">
                        <span class="flex items-center gap-2"><i class="bi bi-people"></i> Vínculos</span>
                        <i class="bi bi-chevron-down transition-transform" data-chevron></i>
                    </button>
                    <div class="hidden flex-col gap-1 px-2 pb-2" data-mobile-submenu="vinculos">
                        <a href="{% url 'novo_cliente' %}" class="flex items-center gap-2 px-2 py-2 rounded text-slate-600 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800"><i class="bi bi-person-plus"></i> Cliente</a>
                        <a href="{% url 'novo_parceiro' %}" class="flex items-center gap-2 px-2 py-2 rounded text-slate-600 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800"><i class="bi bi-person-plus"></i> Parceiro</a>
                        <a href="{% url 'lista_clientes' %}" class="flex items-center gap-2 px-2 py-2 rounded text-slate-600 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800"><i class="bi bi-list"></i> Listar Clientes</a>
                        <a href="{% url 'lista_parceiros' %}" class="flex items-center gap-2 px-2 py-2 rounded text-slate-600 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800"><i class="bi bi-list"></i> Listar Parceiros</a>
                    </div>
                </div>
                {% endif %}

                

                {% if user.is_authenticated %}
                <div class="border border-slate-200 dark:border-slate-700 rounded-md">
                    <button type="button" class="w-full flex items-center justify-between px-3 py-2 rounded-md font-medium text-left text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800" data-mobile-toggle="adesoes" aria-expanded="false">
                        <span class="flex items-center gap-2"><i class="bi bi-file-earmark-plus"></i> Adesões</span>
                        <i class="bi bi-chevron-down transition-transform" data-chevron></i>
                    </button>
                    <div class="hidden flex-col gap-1 px-2 pb-2" data-mobile-submenu="adesoes">
                        <a href="{% url 'adesao:list' %}" class="flex items-center gap-2 px-2 py-2 rounded text-slate-600 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800"><i class="bi bi-list"></i> Listar Adesões</a>
                        {% if user.is_superuser or user.is_staff or perms.adesao.add_adesao %}
                        <a href="{% url 'adesao:create' %}" class="flex items-center gap-2 px-2 py-2 rounded text-slate-600 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800"><i class="bi bi-plus"></i> Nova Adesão</a>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                {% if user.is_authenticated %}
                <div class="border border-slate-200 dark:border-slate-700 rounded-md">
                    <button type="button" class="w-full flex items-center justify-between px-3 py-2 rounded-md font-medium text-left text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800" data-mobile-toggle="compensacoes" aria-expanded="false">
                        <span class="flex items-center gap-2"><i class="bi bi-arrow-left-right"></i> Compensações</span>
                        <i class="bi bi-chevron-down transition-transform" data-chevron></i>
                    </button>
                    <div class="hidden flex-col gap-1 px-2 pb-2" data-mobile-submenu="compensacoes">
                        <a href="{% url 'lancamentos:list' %}" class="flex items-center gap-2 px-2 py-2 rounded text-slate-600 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800"><i class="bi bi-list"></i> Listar Declarações</a>
                        {% if user.is_superuser or user.is_staff or perms.lancamentos.add_lancamentos %}
                        <a href="{% url 'lancamentos:create' %}" class="flex items-center gap-2 px-2 py-2 rounded text-slate-600 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800"><i class="bi bi-plus"></i> Nova Declaração</a>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                <!-- Perfil & Sessão -->
                <div class="pt-2 border-t border-slate-200 dark:border-slate-700 mt-2">
                    {% if not user.is_superuser and not user.is_staff %}
                    <a href="{% url 'accounts:profile' %}" class="flex items-center gap-2 px-3 py-2 rounded-md font-medium text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800"><i class="bi bi-person"></i> Meu Perfil</a>
                    {% else %}
                    <a href="{% url 'admin:index' %}" class="flex items-center gap-2 px-3 py-2 rounded-md font-medium text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800"><i class="bi bi-shield-lock"></i> Admin</a>
                    {% endif %}
                    <button type="button" id="theme-toggle-mobile" class="w-full flex items-center gap-2 px-3 py-2 rounded-md font-medium text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800"><i class="bi bi-moon-stars"></i><span>Tema</span></button>
                    <a href="{% url 'accounts:logout' %}" class="flex items-center gap-2 px-3 py-2 rounded-md font-medium text-slate-700 hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800"><i class="bi bi-box-arrow-right"></i> Sair</a>
                </div>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-1" tabindex="-1">
        <div class="container mx-auto px-4 py-6">
            <!-- System Messages -->
            {% if messages %}
            <div class="space-y-3 mb-6">
                {% for message in messages %}
                <div class="flex items-start gap-3 rounded-lg border px-4 py-3 text-sm shadow-sm
                    {% if message.tags == 'error' %} border-red-500/50 bg-red-50 text-red-700 dark:bg-red-950/50 dark:text-red-300 dark:border-red-800
                    {% elif message.tags == 'success' %} border-green-500/50 bg-green-50 text-green-700 dark:bg-green-950/40 dark:text-green-300 dark:border-green-800
                    {% elif message.tags == 'warning' %} border-amber-500/50 bg-amber-50 text-amber-700 dark:bg-amber-950/40 dark:text-amber-300 dark:border-amber-800
                    {% else %} border-blue-500/50 bg-blue-50 text-blue-700 dark:bg-blue-950/40 dark:text-blue-300 dark:border-blue-800 {% endif %}" role="alert">
                    <div class="flex-shrink-0 mt-0.5">
                        {% if message.tags == 'success' %}
                        <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        {% elif message.tags == 'warning' %}
                        <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                        </svg>
                        {% elif message.tags == 'error' %}
                        <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        {% else %}
                        <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
                        </svg>
                        {% endif %}
                    </div>
                    <div class="flex-1">{{ message }}</div>
                    <button type="button" class="flex-shrink-0 ml-auto hover:opacity-70 transition-opacity" onclick="this.parentElement.remove()">
                        <span class="sr-only">Fechar</span>
                        <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            {% block page_title %}{% endblock %}

            {% block content %}{% endblock %}
        </div>
    </main>

    <!-- Footer -->
    <footer class="border-t bg-slate-50/80 dark:bg-slate-950/80 backdrop-blur supports-[backdrop-filter]:bg-slate-50/70 dark:supports-[backdrop-filter]:bg-slate-950/60">
        <div class="container mx-auto px-4 py-6">
            <div class="text-center text-sm text-muted-foreground">
                <p>© 2025 PERDCOMP. Todos os direitos reservados.</p>
                <div class="mt-2 space-x-4">
                    <a href="#" class="hover:text-foreground transition-colors">Política de Privacidade</a>
                    <span>•</span>
                    <a href="#" class="hover:text-foreground transition-colors">Termos de Uso</a>
                    <span>•</span>
                    <a href="#" class="hover:text-foreground transition-colors">Contato</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    {% load static %}
    <!-- Bootstrap JS (necessário para modais / tooltips usados atualmente) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'js/logout-confirm.js' %}"></script>
    
    {# Bloco existente para páginas que já usam 'extra_js' #}
    {% block extra_js %}{% endblock %}
    {# Novo bloco para compatibilidade com templates que usam 'scripts' #}
    {% block scripts %}{% endblock %}
    
    <script>
        // Mobile menu toggle
        document.getElementById('mobile-menu-button').addEventListener('click', function() {
            const menu = document.getElementById('mobile-menu');
            const expanded = this.getAttribute('aria-expanded') === 'true';
            this.setAttribute('aria-expanded', !expanded);
            menu.classList.toggle('hidden');
        });

        // Mobile submenu accordions
        document.querySelectorAll('[data-mobile-toggle]').forEach(btn => {
            btn.addEventListener('click', () => {
                const key = btn.getAttribute('data-mobile-toggle');
                const panel = document.querySelector(`[data-mobile-submenu="${key}"]`);
                const chevron = btn.querySelector('[data-chevron]');
                const expanded = btn.getAttribute('aria-expanded') === 'true';
                btn.setAttribute('aria-expanded', !expanded);
                if(panel){
                    panel.classList.toggle('hidden');
                }
                if(chevron){
                    chevron.classList.toggle('rotate-180');
                }
            });
        });

        // Mobile theme toggle
        const themeMobileBtn = document.getElementById('theme-toggle-mobile');
        if(themeMobileBtn){
            themeMobileBtn.addEventListener('click', () => {
                const root = document.documentElement;
                const isDark = root.classList.toggle('dark');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
            });
        }

        // Theme toggle
        document.getElementById('theme-toggle').addEventListener('click', function() {
            const root = document.documentElement;
            const isDark = root.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        });

        // Auto-dismiss alerts after 5 seconds
        document.addEventListener('DOMContentLoaded', function() {
            const alerts = document.querySelectorAll('[role="alert"]');
            alerts.forEach(function(alert) {
                setTimeout(function() {
                    if (alert.parentNode) {
                        alert.remove();
                    }
                }, 5000);
            });
        });
    </script>
</body>
</html>
