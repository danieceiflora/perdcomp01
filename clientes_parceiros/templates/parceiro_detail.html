{% extends 'base.html' %}
{% load static %}

{% block title %}Detalhe do Parceiro{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
  <!-- Page Header -->
  <div class="mb-8">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
      <div>
        <h1 class="text-2xl font-bold text-foreground flex items-center gap-2">
          <i class="bi bi-handshake"></i>
          Detalhe do Parceiro
        </h1>
        <p class="text-muted-foreground mt-1">Informações completas do parceiro cadastrado</p>
      </div>
      <div class="flex flex-col sm:flex-row gap-2">
        <a href="{% url 'lista_parceiros' %}" class="inline-flex items-center justify-center rounded-md border border-input bg-background px-4 py-2 text-sm font-medium text-foreground shadow-sm transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring">
          <i class="bi bi-arrow-left mr-2"></i>Voltar
        </a>
        {% if user.is_superuser or user.is_staff %}
        <a href="{% url 'editar_parceiro' parceiro.pk %}" class="btn-primary">
          <i class="bi bi-pencil mr-2"></i>Editar
        </a>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Messages -->
  {% if messages %}
    <div class="mb-6 space-y-2">
      {% for message in messages %}
        <div class="relative rounded-md border px-4 py-3 text-sm {% if message.tags == 'success' %}border-green-200 bg-green-50 text-green-800 dark:border-green-800 dark:bg-green-950 dark:text-green-200{% elif message.tags == 'error' %}border-red-200 bg-red-50 text-red-800 dark:border-red-800 dark:bg-red-950 dark:text-red-200{% elif message.tags == 'warning' %}border-amber-200 bg-amber-50 text-amber-800 dark:border-amber-800 dark:bg-amber-950 dark:text-amber-200{% else %}border-blue-200 bg-blue-50 text-blue-800 dark:border-blue-800 dark:bg-blue-950 dark:text-blue-200{% endif %}">
          {{ message }}
          <button type="button" class="absolute top-2 right-2 rounded-md p-1 hover:bg-black/5 dark:hover:bg-white/5" onclick="this.parentElement.remove()">
            <i class="bi bi-x"></i>
          </button>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <!-- Partner Information Cards -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
    <!-- Company Card -->
    <div class="card">
      <div class="card-header">
        <h3 class="text-lg font-semibold flex items-center gap-2">
          <i class="bi bi-building"></i>
          Empresa Parceira
        </h3>
      </div>
      <div class="card-content">
        <div class="text-center mb-4">
          {% if parceiro.id_company_vinculada.logomarca %}
            <img src="{{ parceiro.id_company_vinculada.logomarca.url }}" 
                 alt="Logo" 
                 class="w-20 h-20 object-contain mx-auto rounded border border-border bg-white p-2">
          {% else %}
            <div class="w-20 h-20 mx-auto rounded border border-border bg-muted flex items-center justify-center">
              <i class="bi bi-building text-2xl text-muted-foreground"></i>
            </div>
          {% endif %}
        </div>
        <h4 class="font-semibold text-foreground mb-2">{{ parceiro.id_company_vinculada.nome_fantasia|default:parceiro.id_company_vinculada.razao_social }}</h4>
        <div class="space-y-2 text-sm">
          <p class="text-muted-foreground">
            <span class="font-medium">Razão Social:</span><br>
            {{ parceiro.id_company_vinculada.razao_social }}
          </p>
          <p><span class="font-medium text-muted-foreground">CNPJ:</span> {{ parceiro.id_company_vinculada.cnpj }}</p>
          <p><span class="font-medium text-muted-foreground">Data Início:</span> {{ parceiro.data_inicio_parceria|date:'d/m/Y' }}</p>
          <p class="flex items-center gap-2">
            <span class="font-medium text-muted-foreground">Status:</span>
            {% if parceiro.ativo %}
              <span class="inline-flex items-center rounded-full bg-green-500/10 px-2.5 py-0.5 text-xs font-medium text-green-700 dark:text-green-300">Ativo</span>
            {% else %}
              <span class="inline-flex items-center rounded-full bg-red-500/10 px-2.5 py-0.5 text-xs font-medium text-red-700 dark:text-red-300">Inativo</span>
            {% endif %}
          </p>
          <p class="flex items-center gap-2">
            <span class="font-medium text-muted-foreground">Tipo:</span>
            <span class="inline-flex items-center rounded-full bg-primary/10 px-2.5 py-0.5 text-xs font-medium text-primary">Parceiro</span>
          </p>
        </div>
      </div>
    </div>

    <!-- Reference Card -->
    <div class="card">
      <div class="card-header">
        <h3 class="text-lg font-semibold flex items-center gap-2">
          <i class="bi bi-person"></i>
          Referência
        </h3>
      </div>
      <div class="card-content">
        <div class="space-y-3">
          <div>
            <p class="font-medium text-muted-foreground mb-1">Nome:</p>
            <p class="text-foreground">{{ parceiro.nome_referencia|default:'-' }}</p>
          </div>
          <div>
            <p class="font-medium text-muted-foreground mb-1">Cargo:</p>
            <p class="text-foreground">{{ parceiro.cargo_referencia|default:'-' }}</p>
          </div>
          <div class="pt-3 border-t">
            <p class="text-sm text-muted-foreground">Esses dados identificam o responsável pelo relacionamento.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Contacts Card -->
    <div class="card">
      <div class="card-header">
        <h3 class="text-lg font-semibold flex items-center gap-2">
          <i class="bi bi-telephone"></i>
          Contatos
        </h3>
      </div>
      <div class="card-content">
        {% if contatos %}
          <div class="space-y-4">
            {% for c in contatos %}
              <div class="pb-3 border-b border-border last:border-b-0 last:pb-0">
                <h5 class="font-medium text-foreground mb-2">{{ c.tipo_contato }}</h5>
                <div class="space-y-1 text-sm">
                  {% if c.telefone %}
                    <p class="flex items-center gap-2 text-muted-foreground">
                      <i class="bi bi-telephone"></i>{{ c.telefone }}
                    </p>
                  {% endif %}
                  {% if c.email %}
                    <a href="mailto:{{ c.email }}" class="flex items-center gap-2 text-primary hover:text-primary/80 transition-colors">
                      <i class="bi bi-envelope"></i>{{ c.email }}
                    </a>
                  {% endif %}
                  {% if c.site %}
                    <a href="{{ c.site }}" target="_blank" class="flex items-center gap-2 text-primary hover:text-primary/80 transition-colors">
                      <i class="bi bi-globe"></i>{{ c.site }}
                    </a>
                  {% endif %}
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-muted-foreground">Nenhum contato cadastrado.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Base Company Relationship Card -->
  <div class="card">
    <div class="card-header">
      <h3 class="text-lg font-semibold flex items-center gap-2">
        <i class="bi bi-link-45deg"></i>
        Relação com a Empresa Base
      </h3>
    </div>
    <div class="card-content">
      <div>
        <p class="mb-2">
          <span class="font-medium text-muted-foreground">Empresa Base:</span> 
          {{ parceiro.id_company_base.nome_fantasia|default:parceiro.id_company_base.razao_social }}
        </p>
        <p class="text-sm text-muted-foreground">A empresa base é atribuída automaticamente (CNPJ 42994794000104).</p>
      </div>
    </div>
  </div>
</div>
{% endblock %}
